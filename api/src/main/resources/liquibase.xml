<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9
                  http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd">
 
    <changeSet id="messages-1" author="Dawid Ruchniewicz">
        <preConditions onFail="MARK_RAN">
            <not><tableExists tableName="messages_scheduled_service_group"/></not>
        </preConditions>
        <comment>Created the messages_scheduled_service_group table</comment>
        <createTable tableName="messages_scheduled_service_group">
            <column name="messages_scheduled_service_group_id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="msg_send_time" type="datetime"/>
            <column name="patient_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="status" type="varchar(255)"/>
            <column name="uuid" type="char(38)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="creator" type="int"/>
            <column name="changed_by" type="int"/>
            <column name="date_changed" type="datetime"/>
            <column name="date_created" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="date_voided" type="datetime"/>
            <column name="void_reason" type="varchar(255)"/>
            <column name="voided" type="BOOLEAN" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>
            <column name="voided_by" type="int"/>
        </createTable>
        <addForeignKeyConstraint constraintName="messages_scheduled_service_group_creator_fk"
                                 baseTableName="messages_scheduled_service_group" baseColumnNames="creator"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="messages_scheduled_service_group_changed_by_fk"
                                 baseTableName="messages_scheduled_service_group" baseColumnNames="changed_by"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="messages_scheduled_service_group_voided_by_fk"
                                 baseTableName="messages_scheduled_service_group" baseColumnNames="voided_by"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="messages_scheduled_service_group_patient_fk"
                                 baseTableName="messages_scheduled_service_group" baseColumnNames="patient_id"
                                 referencedTableName="patient" referencedColumnNames="patient_id"/>
    </changeSet>

    <changeSet id="messages-2" author="Dawid Ruchniewicz">
        <preConditions onFail="MARK_RAN">
            <not><tableExists tableName="messages_template"/></not>
        </preConditions>
        <comment>Created the messages_template table</comment>
        <createTable tableName="messages_template">
            <column name="messages_template_id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="service_query" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column name="service_query_type" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="uuid" type="char(38)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="creator" type="int"/>
            <column name="changed_by" type="int"/>
            <column name="date_changed" type="datetime"/>
            <column name="date_created" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="date_voided" type="datetime"/>
            <column name="void_reason" type="varchar(255)"/>
            <column name="voided" type="BOOLEAN" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>
            <column name="voided_by" type="int"/>
        </createTable>
        <addForeignKeyConstraint constraintName="messages_template_creator_fk"
                                 baseTableName="messages_template" baseColumnNames="creator"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="messages_template_changed_by_fk"
                                 baseTableName="messages_template" baseColumnNames="changed_by"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="messages_template_voided_by_fk"
                                 baseTableName="messages_template" baseColumnNames="voided_by"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        </changeSet>

    <changeSet id="messages-3" author="Dawid Ruchniewicz">
        <preConditions onFail="MARK_RAN">
            <not><tableExists tableName="messages_template_field"/></not>
        </preConditions>
        <comment>Created the messages_template_field table</comment>
        <createTable tableName="messages_template_field">
            <column name="messages_template_field_id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="mandatory" type="boolean">
                <constraints nullable="false"/>
            </column>
            <column name="default_value" type="TEXT"/>
            <column name="template_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="value_concept" type="int"/>
            <column name="uuid" type="char(38)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="creator" type="int"/>
            <column name="changed_by" type="int"/>
            <column name="date_changed" type="datetime"/>
            <column name="date_created" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="date_voided" type="datetime"/>
            <column name="void_reason" type="varchar(255)"/>
            <column name="voided" type="BOOLEAN" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>
            <column name="voided_by" type="int"/>
        </createTable>
        <addForeignKeyConstraint constraintName="messages_template_field_creator_fk"
                                 baseTableName="messages_template_field" baseColumnNames="creator"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="messages_template_field_changed_by_fk"
                                 baseTableName="messages_template_field" baseColumnNames="changed_by"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="messages_template_field_voided_by_fk"
                                 baseTableName="messages_template_field" baseColumnNames="voided_by"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="messages_template_field_template_fk"
                                 baseTableName="messages_template_field" baseColumnNames="template_id"
                                 referencedTableName="messages_template" referencedColumnNames="messages_template_id"/>
        <addForeignKeyConstraint constraintName="messages_template_field_value_concept_fk"
                                 baseTableName="messages_template_field" baseColumnNames="value_concept"
                                 referencedTableName="concept" referencedColumnNames="concept_id"/>
    </changeSet>

    <changeSet id="messages-4" author="Dawid Ruchniewicz">
        <preConditions onFail="MARK_RAN">
            <not><tableExists tableName="messages_template_field_value"/></not>
        </preConditions>
        <comment>Created the messages_template_field_value table</comment>
        <createTable tableName="messages_template_field_value">
            <column name="messages_template_field_value_id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="value" type="varchar(255)"/>
            <column name="template_field_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="patient_template_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="uuid" type="char(38)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="creator" type="int"/>
            <column name="changed_by" type="int"/>
            <column name="date_changed" type="datetime"/>
            <column name="date_created" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="date_voided" type="datetime"/>
            <column name="void_reason" type="varchar(255)"/>
            <column name="voided" type="BOOLEAN" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>
            <column name="voided_by" type="int"/>
        </createTable>
        <addForeignKeyConstraint constraintName="messages_template_field_value_creator_fk"
                                 baseTableName="messages_template_field_value" baseColumnNames="creator"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="messages_template_field_value_changed_by_fk"
                                 baseTableName="messages_template_field_value" baseColumnNames="changed_by"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="messages_template_field_value_voided_by_fk"
                                 baseTableName="messages_template_field_value" baseColumnNames="voided_by"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="messages_template_field_value_template_field_fk"
                                 baseTableName="messages_template_field_value" baseColumnNames="template_field_id"
                                 referencedTableName="messages_template_field"
                                 referencedColumnNames="messages_template_field_id"/>
        </changeSet>

    <changeSet id="messages-5" author="Dawid Ruchniewicz">
        <preConditions onFail="MARK_RAN">
            <not><tableExists tableName="messages_patient_template"/></not>
        </preConditions>
        <comment>Created the messages_patient_template table</comment>
        <createTable tableName="messages_patient_template">
            <column name="messages_patient_template_id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="actor_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="actor_type" type="int"/>
            <column name="service_query" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column name="service_query_type" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="patient_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="template_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="uuid" type="char(38)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="creator" type="int"/>
            <column name="changed_by" type="int"/>
            <column name="date_changed" type="datetime"/>
            <column name="date_created" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="date_voided" type="datetime"/>
            <column name="void_reason" type="varchar(255)"/>
            <column name="voided" type="BOOLEAN" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>
            <column name="voided_by" type="int"/>
        </createTable>
        <addForeignKeyConstraint constraintName="messages_patient_template_creator_fk"
                                 baseTableName="messages_patient_template" baseColumnNames="creator"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="messages_patient_template_changed_by_fk"
                                 baseTableName="messages_patient_template" baseColumnNames="changed_by"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="messages_patient_template_voided_by_fk"
                                 baseTableName="messages_patient_template" baseColumnNames="voided_by"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="messages_patient_template_actor_fk"
                                 baseTableName="messages_patient_template" baseColumnNames="actor_id"
                                 referencedTableName="person" referencedColumnNames="person_id"/>
        <addForeignKeyConstraint constraintName="messages_patient_template_actor_type_fk"
                                 baseTableName="messages_patient_template" baseColumnNames="actor_type"
                                 referencedTableName="relationship" referencedColumnNames="relationship_id"/>
        <addForeignKeyConstraint constraintName="messages_patient_template_patient_fk"
                                 baseTableName="messages_patient_template" baseColumnNames="patient_id"
                                 referencedTableName="patient" referencedColumnNames="patient_id"/>
        <addForeignKeyConstraint constraintName="messages_patient_template_template_fk"
                                 baseTableName="messages_patient_template" baseColumnNames="template_id"
                                 referencedTableName="messages_template_field_value"
                                 referencedColumnNames="messages_template_field_value_id"/>
    </changeSet>

    <changeSet id="messages-6" author="Dawid Ruchniewicz">
        <preConditions>
            <not><tableExists tableName="messages_scheduled_service"/></not>
        </preConditions>
        <comment>Created the messages_scheduled_service table</comment>
        <createTable tableName="messages_scheduled_service">
            <column name="messages_scheduled_service_id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="group_id" type="int"/>
            <column name="service" type="int"/>
            <column name="patient_template_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="channel_type" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="status" type="varchar(255)"/>
            <column name="last_service_execution_id" type="int"/>
            <column name="uuid" type="char(38)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="creator" type="int"/>
            <column name="changed_by" type="int"/>
            <column name="date_changed" type="datetime"/>
            <column name="date_created" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="date_voided" type="datetime"/>
            <column name="void_reason" type="varchar(255)"/>
            <column name="voided" type="BOOLEAN" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>
            <column name="voided_by" type="int"/>
        </createTable>
        <addForeignKeyConstraint constraintName="messages_scheduled_service_creator_fk"
                                 baseTableName="messages_scheduled_service" baseColumnNames="creator"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="messages_scheduled_service_changed_by_fk"
                                 baseTableName="messages_scheduled_service" baseColumnNames="changed_by"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="messages_scheduled_service_voided_by_fk"
                                 baseTableName="messages_scheduled_service" baseColumnNames="voided_by"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="messages_scheduled_service_group_fk"
                                 baseTableName="messages_scheduled_service" baseColumnNames="group_id"
                                 referencedTableName="messages_scheduled_service_group"
                                 referencedColumnNames="messages_scheduled_service_group_id"/>
        <addForeignKeyConstraint constraintName="messages_scheduled_service_service_fk"
                                 baseTableName="messages_scheduled_service" baseColumnNames="service"
                                 referencedTableName="concept" referencedColumnNames="concept_id"/>
        <addForeignKeyConstraint constraintName="messages_scheduled_service_patient_template_fk"
                                 baseTableName="messages_scheduled_service" baseColumnNames="patient_template_id"
                                 referencedTableName="messages_patient_template"
                                 referencedColumnNames="messages_patient_template_id"/>
        <addForeignKeyConstraint constraintName="messages_scheduled_service_channel_type_fk"
                                 baseTableName="messages_scheduled_service" baseColumnNames="channel_type"
                                 referencedTableName="concept" referencedColumnNames="concept_id"/>
    </changeSet>

    <changeSet id="messages-7" author="Dawid Ruchniewicz">
        <preConditions>
            <not><tableExists tableName="messages_actor_response"/></not>
        </preConditions>
        <comment>Created the messages_actor_response table</comment>
        <createTable tableName="messages_actor_response">
            <column name="messages_actor_response_id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="scheduled_service_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="question" type="int"/>
            <column name="response" type="int"/>
            <column name="text_response" type="TEXT"/>
            <column name="answered_time" type="datetime"/>
            <column name="uuid" type="char(38)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="creator" type="int"/>
            <column name="changed_by" type="int"/>
            <column name="date_changed" type="datetime"/>
            <column name="date_created" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="date_voided" type="datetime"/>
            <column name="void_reason" type="varchar(255)"/>
            <column name="voided" type="BOOLEAN" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>
            <column name="voided_by" type="int"/>
        </createTable>
        <addForeignKeyConstraint constraintName="messages_actor_response_creator_fk"
                                 baseTableName="messages_actor_response" baseColumnNames="creator"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="messages_actor_response_changed_by_fk"
                                 baseTableName="messages_actor_response" baseColumnNames="changed_by"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="messages_actor_response_voided_by_fk"
                                 baseTableName="messages_actor_response" baseColumnNames="voided_by"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="messages_actor_response_scheduled_service_fk"
                                 baseTableName="messages_actor_response" baseColumnNames="scheduled_service_id"
                                 referencedTableName="messages_scheduled_service"
                                 referencedColumnNames="messages_scheduled_service_id"/>
        <addForeignKeyConstraint constraintName="messages_actor_response_question_fk"
                                 baseTableName="messages_actor_response" baseColumnNames="question"
                                 referencedTableName="concept" referencedColumnNames="concept_id"/>
        <addForeignKeyConstraint constraintName="messages_actor_response_response_fk"
                                 baseTableName="messages_actor_response" baseColumnNames="response"
                                 referencedTableName="concept" referencedColumnNames="concept_id"/>
    </changeSet>

    <changeSet id="messages-8" author="Dawid Ruchniewicz">
        <preConditions>
            <not><tableExists tableName="messages_delivery_attempt"/></not>
        </preConditions>
        <comment>Created the messages_delivery_attempt table</comment>
        <createTable tableName="messages_delivery_attempt">
            <column name="messages_delivery_attempt_id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="scheduled_service_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="timestamp" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="new_status" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="attempt_number" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="service_execution_id" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="uuid" type="char(38)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="creator" type="int"/>
            <column name="changed_by" type="int"/>
            <column name="date_changed" type="datetime"/>
            <column name="date_created" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="date_voided" type="datetime"/>
            <column name="void_reason" type="varchar(255)"/>
            <column name="voided" type="BOOLEAN" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>
            <column name="voided_by" type="int"/>
        </createTable>
        <addForeignKeyConstraint constraintName="messages_delivery_attempt_creator_fk"
                                 baseTableName="messages_delivery_attempt" baseColumnNames="creator"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="messages_delivery_attempt_changed_by_fk"
                                 baseTableName="messages_delivery_attempt" baseColumnNames="changed_by"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="messages_delivery_attempt_voided_by_fk"
                                 baseTableName="messages_delivery_attempt" baseColumnNames="voided_by"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="messages_delivery_attempt_service_fk"
                                 baseTableName="messages_delivery_attempt" baseColumnNames="scheduled_service_id"
                                 referencedTableName="concept" referencedColumnNames="concept_id"/>
    </changeSet>

    <changeSet id="messages-9" author="Dawid Ruchniewicz">
        <preConditions>
            <not><tableExists tableName="messages_schedule_service_parameter"/></not>
        </preConditions>
        <comment>Created the messages_schedule_service_parameter table</comment>
        <createTable tableName="messages_schedule_service_parameter">
            <column name="messages_schedule_service_parameter_id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="scheduled_message" type="int"/>
            <column name="parameter_type" type="varchar(255)"/>
            <column name="parameter_value" type="TEXT"/>
            <column name="uuid" type="char(38)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="creator" type="int"/>
            <column name="changed_by" type="int"/>
            <column name="date_changed" type="datetime"/>
            <column name="date_created" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="date_voided" type="datetime"/>
            <column name="void_reason" type="varchar(255)"/>
            <column name="voided" type="BOOLEAN" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>
            <column name="voided_by" type="int"/>
        </createTable>
        <addForeignKeyConstraint constraintName="messages_schedule_service_parameter_creator_fk"
                                 baseTableName="messages_schedule_service_parameter" baseColumnNames="creator"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="messages_schedule_service_parameter_changed_by_fk"
                                 baseTableName="messages_schedule_service_parameter" baseColumnNames="changed_by"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="messages_schedule_service_parameter_voided_by_fk"
                                 baseTableName="messages_schedule_service_parameter" baseColumnNames="voided_by"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="messages_schedule_service_parameter_scheduled_message_fk"
                                 baseTableName="messages_schedule_service_parameter" baseColumnNames="scheduled_message"
                                 referencedTableName="messages_scheduled_service"
                                 referencedColumnNames="messages_scheduled_service_id"/>
    </changeSet>

    <changeSet id="messages-10" author="Paweł Cieszko">
        <addUniqueConstraint columnNames="actor_id, patient_id, template_id"
                             constraintName="messages_patient_template_actor_id_patient_id_template_id_ux"
                             tableName="messages_patient_template"/>
    </changeSet>

    <changeSet id="messages-11" author="Dawid Ruchniewcz">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="messages_template_field_value"/>
            <columnExists tableName="messages_template_field_value" columnName="patient_template_id"/>
        </preConditions>
        <comment>Removed patient_template_id column</comment>
        <dropColumn tableName="messages_template_field_value"
                    columnName="patient_template_id"/>
    </changeSet>

    <changeSet id="messages-12" author="Dawid Ruchniewicz">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="messages_scheduled_service"/>
            <columnExists tableName="messages_scheduled_service" columnName="last_service_execution_id"/>
        </preConditions>
        <comment>Removed lastServiceExecution column</comment>
        <dropColumn tableName="messages_scheduled_service"
                    columnName="last_service_execution_id"/>
    </changeSet>

    <changeSet id="messages-13" author="Dawid Ruchniewicz">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="messages_scheduled_service"/>
        </preConditions>
        <comment>Added lastServiceExecution column</comment>
        <addColumn tableName="messages_scheduled_service">
            <column name="last_service_execution_id" type="varchar(255)"/>
        </addColumn>
    </changeSet>
    
    <changeSet id="messages-14" author="Daniel Serkowski">
        <preConditions>
            <tableExists tableName="messages_delivery_attempt"/>
        </preConditions>
        <dropForeignKeyConstraint constraintName="messages_delivery_attempt_service_fk" 
                                  baseTableName="messages_delivery_attempt" />
        <addForeignKeyConstraint constraintName="messages_delivery_attempt_scheduled_service_fk"
                                 baseTableName="messages_delivery_attempt" baseColumnNames="scheduled_service_id"
                                 referencedTableName="messages_scheduled_service"
                                 referencedColumnNames="messages_scheduled_service_id" />
    </changeSet>

    <changeSet id="messages-15" author="Arkadiusz Lalo">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="messages_template_field"/>
        </preConditions>
        <comment>Added templateFieldType column</comment>
        <addColumn tableName="messages_template_field">
            <column name="template_field_type" type="varchar(255)">
                <constraints nullable="false" />
            </column>
        </addColumn>
        <dropForeignKeyConstraint constraintName="messages_template_field_value_concept_fk" baseTableName="messages_template_field"/>
        <dropColumn tableName="messages_template_field" columnName="value_concept"/>
    </changeSet>

    <changeSet id="messages-16" author="Arkadiusz Lalo">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="messages_template"/>
        </preConditions>
        <comment>Added name column</comment>
        <addColumn tableName="messages_template">
            <column name="name" type="varchar(255)">
                <constraints nullable="false" />
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="messages-17" author="Karol Cissewski">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="messages_template_field_value"/>
        </preConditions>
        <comment>Added patient_template_id column</comment>
        <addColumn tableName="messages_template_field_value">
            <column name="patient_template_id" type="int">
                <constraints nullable="false" />
            </column>
        </addColumn>
        <addForeignKeyConstraint baseTableName="messages_template_field_value" baseColumnNames="patient_template_id"
                                 constraintName="fk_messages_template_field_value_patient_template_id"
                                 referencedTableName="messages_patient_template"
                                 referencedColumnNames="messages_patient_template_id"/>
    </changeSet>

    <changeSet id="messages-18" author="Daniel Serkowski">
        <preConditions>
            <tableExists tableName="messages_patient_template" />
            <tableExists tableName="messages_template" />
        </preConditions>
        <comment>Fixing incorrect FK definition between PatientTemplate and Template tables</comment>
        <dropForeignKeyConstraint baseTableName="messages_patient_template"
                                  constraintName="messages_patient_template_template_fk" />
        <addForeignKeyConstraint constraintName="messages_patient_template_template_fk"
                                 baseTableName="messages_patient_template" baseColumnNames="template_id"
                                 referencedTableName="messages_template"
                                 referencedColumnNames="messages_template_id"/>
    </changeSet>

    <changeSet id="messages-19" author="Dawid Ruchniewicz">
        <comment>Added templates and their template fields</comment>
        <insert tableName="messages_template">
            <column name="messages_template_id">1</column>
            <column name="service_query">select EXECUTION_DATE, MESSAGE_ID, CHANNEL_ID, mssg_status as STATUS_ID from
                (select TIMESTAMP(selected_date, times) AS EXECUTION_DATE, 1 AS MESSAGE_ID, :Service_type AS CHANNEL_ID
                from (select * from (select adddate('2019-12-01',t4*10000 + t3*1000 + t2*100 + t1*10 + t0) selected_date
                from  (select 0 t0 union select 1 union select 2 union select 3 union select 4 union  select 5 union
                select 6 union select 7 union select 8 union select 9) t0,  (select 0 t1 union select 1 union
                select 2 union select 3 union select 4 union  select 5 union select 6 union select 7 union
                select 8 union select 9) t1,  (select 0 t2 union select 1 union select 2 union select 3 union
                select 4 union  select 5 union select 6 union select 7 union select 8 union select 9) t2,
                (select 0 t3 union select 1 union select 2 union select 3 union select 4 union  select 5 union
                select 6 union select 7 union select 8 union select 9) t3,  (select 0 t4 union select 1 union
                select 2 union select 3 union select 4 union  select 5 union select 6 union select 7 union
                select 8 union select 9) t4) v where selected_date between :Start_of_daily_messages and :End_of_daily_messages
                and selected_date between :startDate and :endDate  and :Week_day_of_delivering_message
                like concat('%',DAYNAME(selected_date),'%') ) dates JOIN (select '09:00:00' times) timeslist) temp
                LEFT JOIN (select mssg.msg_send_time as mssg_dates, mssg.status as mssg_status
                from messages_scheduled_service_group mssg where mssg.patient_id = :patientId) mss on mss.mssg_dates = EXECUTION_DATE;
            </column>
            <column name="service_query_type">SQL</column>
            <column name="name">Adherence report daily</column>
            <column name="uuid">868278cc-1c16-11ea-8999-0242ac160002</column>
            <column name="creator">1</column>
            <column name="changed_by">NULL</column>
            <column name="date_changed">NULL</column>
            <column name="date_created">1970-01-01 01:00:01</column>
            <column name="date_voided">NULL</column>
            <column name="void_reason">NULL</column>
            <column name="voided">0</column>
            <column name="voided_by">NULL</column>
        </insert>
        <insert tableName="messages_template_field">
            <column name="messages_template_field_id">1</column>
            <column name="name">Service type</column>
            <column name="mandatory">1</column>
            <column name="default_value">Deactivate service</column>
            <column name="template_id">1</column>
            <column name="template_field_type">SERVICE_TYPE</column>
            <column name="uuid">86834fd6-1c16-11ea-8999-0242ac160002</column>
            <column name="creator">1</column>
            <column name="changed_by">NULL</column>
            <column name="date_changed">NULL</column>
            <column name="date_created">1970-01-01 01:00:01</column>
            <column name="date_voided">NULL</column>
            <column name="void_reason">NULL</column>
            <column name="voided">0</column>
            <column name="voided_by">NULL</column>
        </insert>
        <insert tableName="messages_template_field">
            <column name="messages_template_field_id">2</column>
            <column name="name">Week day of delivering message</column>
            <column name="mandatory">1</column>
            <column name="default_value">Monday,Tuesday,Wednesday,Thursday,Friday,Saturday,Sunday</column>
            <column name="template_id">1</column>
            <column name="template_field_type">DAY_OF_WEEK</column>
            <column name="uuid">868491e5-1c16-11ea-8999-0242ac160002</column>
            <column name="creator">1</column>
            <column name="changed_by">NULL</column>
            <column name="date_changed">NULL</column>
            <column name="date_created">1970-01-01 01:00:01.000</column>
            <column name="date_voided">NULL</column>
            <column name="void_reason">NULL</column>
            <column name="voided">0</column>
            <column name="voided_by">NULL</column>
        </insert>
        <insert tableName="messages_template_field">
            <column name="messages_template_field_id">3</column>
            <column name="name">Start of daily messages</column>
            <column name="mandatory">0</column>
            <column name="default_value">2019-12-09</column>
            <column name="template_id">1</column>
            <column name="template_field_type">START_OF_MESSAGES</column>
            <column name="uuid">86858cdd-1c16-11ea-8999-0242ac160002</column>
            <column name="creator">1</column>
            <column name="changed_by">NULL</column>
            <column name="date_changed">NULL</column>
            <column name="date_created">1970-01-01 01:00:01.000</column>
            <column name="date_voided">NULL</column>
            <column name="void_reason">NULL</column>
            <column name="voided">0</column>
            <column name="voided_by">NULL</column>
        </insert>
        <insert tableName="messages_template_field">
            <column name="messages_template_field_id">4</column>
            <column name="name">End of daily messages</column>
            <column name="mandatory">1</column>
            <column name="default_value">2020-01-30</column>
            <column name="template_id">1</column>
            <column name="template_field_type">END_OF_MESSAGES</column>
            <column name="uuid">8689519a-1c16-11ea-8999-0242ac160002</column>
            <column name="creator">1</column>
            <column name="changed_by">NULL</column>
            <column name="date_changed">NULL</column>
            <column name="date_created">1970-01-01 01:00:01.000</column>
            <column name="date_voided">NULL</column>
            <column name="void_reason">NULL</column>
            <column name="voided">0</column>
            <column name="voided_by">NULL</column>
        </insert>
        <insert tableName="messages_template">
            <column name="messages_template_id">3</column>
            <column name="service_query">''</column>
            <column name="service_query_type">''</column>
            <column name="name">Adherence feedback</column>
            <column name="uuid">868a8f7b-1c16-11ea-8999-0242ac160002</column>
            <column name="creator">1</column>
            <column name="changed_by">NULL</column>
            <column name="date_changed">NULL</column>
            <column name="date_created">1970-01-01 01:00:01</column>
            <column name="date_voided">NULL</column>
            <column name="void_reason">NULL</column>
            <column name="voided">0</column>
            <column name="voided_by">NULL</column>
        </insert>
        <insert tableName="messages_template_field">
            <column name="messages_template_field_id">20</column>
            <column name="name">Service type</column>
            <column name="mandatory">1</column>
            <column name="default_value">Deactivate service</column>
            <column name="template_id">3</column>
            <column name="template_field_type">SERVICE_TYPE</column>
            <column name="uuid">868bd0ac-1c16-11ea-8999-0242ac160002</column>
            <column name="creator">1</column>
            <column name="changed_by">NULL</column>
            <column name="date_changed">NULL</column>
            <column name="date_created">1970-01-01 01:00:01.000</column>
            <column name="date_voided">NULL</column>
            <column name="void_reason">NULL</column>
            <column name="voided">0</column>
            <column name="voided_by">NULL</column>
        </insert>
        <insert tableName="messages_template_field">
            <column name="messages_template_field_id">21</column>
            <column name="name">Frequency of the message</column>
            <column name="mandatory">1</column>
            <column name="default_value">Monthly</column>
            <column name="template_id">3</column>
            <column name="template_field_type">MESSAGING_FREQUENCY</column>
            <column name="uuid">868fb9a6-1c16-11ea-8999-0242ac160002</column>
            <column name="creator">1</column>
            <column name="changed_by">NULL</column>
            <column name="date_changed">NULL</column>
            <column name="date_created">1970-01-01 01:00:01.000</column>
            <column name="date_voided">NULL</column>
            <column name="void_reason">NULL</column>
            <column name="voided">0</column>
            <column name="voided_by">NULL</column>
        </insert>
        <insert tableName="messages_template_field">
            <column name="messages_template_field_id">22</column>
            <column name="name">Week day of delivering message</column>
            <column name="mandatory">1</column>
            <column name="default_value">Monday,Tuesday,Wednesday,Thursday,Friday,Saturday,Sunday</column>
            <column name="template_id">3</column>
            <column name="template_field_type">DAY_OF_WEEK</column>
            <column name="uuid">8690f1fe-1c16-11ea-8999-0242ac160002</column>
            <column name="creator">1</column>
            <column name="changed_by">NULL</column>
            <column name="date_changed">NULL</column>
            <column name="date_created">1970-01-01 01:00:01.000</column>
            <column name="date_voided">NULL</column>
            <column name="void_reason">NULL</column>
            <column name="voided">0</column>
            <column name="voided_by">NULL</column>
        </insert>
        <insert tableName="messages_template_field">
            <column name="messages_template_field_id">23</column>
            <column name="name">Start of messages</column>
            <column name="mandatory">0</column>
            <column name="default_value">2019-12-09</column>
            <column name="template_id">3</column>
            <column name="template_field_type">START_OF_MESSAGES</column>
            <column name="uuid">8692296c-1c16-11ea-8999-0242ac160002</column>
            <column name="creator">1</column>
            <column name="changed_by">NULL</column>
            <column name="date_changed">NULL</column>
            <column name="date_created">1970-01-01 01:00:01.000</column>
            <column name="date_voided">NULL</column>
            <column name="void_reason">NULL</column>
            <column name="voided">0</column>
            <column name="voided_by">NULL</column>
        </insert>
        <insert tableName="messages_template_field">
            <column name="messages_template_field_id">24</column>
            <column name="name">End of messages</column>
            <column name="mandatory">1</column>
            <column name="default_value">2020-01-30</column>
            <column name="template_id">3</column>
            <column name="template_field_type">END_OF_MESSAGES</column>
            <column name="uuid">8693dd0b-1c16-11ea-8999-0242ac160002</column>
            <column name="creator">1</column>
            <column name="changed_by">NULL</column>
            <column name="date_changed">NULL</column>
            <column name="date_created">1970-01-01 01:00:01.000</column>
            <column name="date_voided">NULL</column>
            <column name="void_reason">NULL</column>
            <column name="voided">0</column>
            <column name="voided_by">NULL</column>
        </insert>
        <insert tableName="messages_template">
            <column name="messages_template_id">4</column>
            <column name="service_query">''</column>
            <column name="service_query_type">''</column>
            <column name="name">Health tip</column>
            <column name="uuid">869522ae-1c16-11ea-8999-0242ac160002</column>
            <column name="creator">1</column>
            <column name="changed_by">NULL</column>
            <column name="date_changed">NULL</column>
            <column name="date_created">1970-01-01 01:00:01</column>
            <column name="date_voided">NULL</column>
            <column name="void_reason">NULL</column>
            <column name="voided">0</column>
            <column name="voided_by">NULL</column>
        </insert>
        <insert tableName="messages_template_field">
            <column name="messages_template_field_id">30</column>
            <column name="name">Service type</column>
            <column name="mandatory">1</column>
            <column name="default_value">Deactivate service</column>
            <column name="template_id">4</column>
            <column name="template_field_type">SERVICE_TYPE</column>
            <column name="uuid">86966e7b-1c16-11ea-8999-0242ac160002</column>
            <column name="creator">1</column>
            <column name="changed_by">NULL</column>
            <column name="date_changed">NULL</column>
            <column name="date_created">1970-01-01 01:00:01.000</column>
            <column name="date_voided">NULL</column>
            <column name="void_reason">NULL</column>
            <column name="voided">0</column>
            <column name="voided_by">NULL</column>
        </insert>
        <insert tableName="messages_template_field">
            <column name="messages_template_field_id">31</column>
            <column name="name">Frequency of the message</column>
            <column name="mandatory">1</column>
            <column name="default_value">Monthly</column>
            <column name="template_id">4</column>
            <column name="template_field_type">MESSAGING_FREQUENCY</column>
            <column name="uuid">8697aa77-1c16-11ea-8999-0242ac160002</column>
            <column name="creator">1</column>
            <column name="changed_by">NULL</column>
            <column name="date_changed">NULL</column>
            <column name="date_created">1970-01-01 01:00:01.000</column>
            <column name="date_voided">NULL</column>
            <column name="void_reason">NULL</column>
            <column name="voided">0</column>
            <column name="voided_by">NULL</column>
        </insert>
        <insert tableName="messages_template_field">
            <column name="messages_template_field_id">32</column>
            <column name="name">Week day of delivering message</column>
            <column name="mandatory">1</column>
            <column name="default_value">Monday,Tuesday,Wednesday,Thursday,Friday,Saturday,Sunday</column>
            <column name="template_id">4</column>
            <column name="template_field_type">DAY_OF_WEEK</column>
            <column name="uuid">8698ecaa-1c16-11ea-8999-0242ac160002</column>
            <column name="creator">1</column>
            <column name="changed_by">NULL</column>
            <column name="date_changed">NULL</column>
            <column name="date_created">1970-01-01 01:00:01.000</column>
            <column name="date_voided">NULL</column>
            <column name="void_reason">NULL</column>
            <column name="voided">0</column>
            <column name="voided_by">NULL</column>
        </insert>
        <insert tableName="messages_template_field">
            <column name="messages_template_field_id">33</column>
            <column name="name">Start of messages</column>
            <column name="mandatory">0</column>
            <column name="default_value">2019-12-09</column>
            <column name="template_id">4</column>
            <column name="template_field_type">START_OF_MESSAGES</column>
            <column name="uuid">869a1860-1c16-11ea-8999-0242ac160002</column>
            <column name="creator">1</column>
            <column name="changed_by">NULL</column>
            <column name="date_changed">NULL</column>
            <column name="date_created">1970-01-01 01:00:01.000</column>
            <column name="date_voided">NULL</column>
            <column name="void_reason">NULL</column>
            <column name="voided">0</column>
            <column name="voided_by">NULL</column>
        </insert>
        <insert tableName="messages_template_field">
            <column name="messages_template_field_id">34</column>
            <column name="name">Categories of the message</column>
            <column name="mandatory">1</column>
            <column name="default_value">Category1</column>
            <column name="template_id">4</column>
            <column name="template_field_type">CATEGORY_OF_MESSAGE</column>
            <column name="uuid">869b5d16-1c16-11ea-8999-0242ac160002</column>
            <column name="creator">1</column>
            <column name="changed_by">NULL</column>
            <column name="date_changed">NULL</column>
            <column name="date_created">1970-01-01 01:00:01.000</column>
            <column name="date_voided">NULL</column>
            <column name="void_reason">NULL</column>
            <column name="voided">0</column>
            <column name="voided_by">NULL</column>
        </insert>
        <insert tableName="messages_template_field">
            <column name="messages_template_field_id">35</column>
            <column name="name">End of messages</column>
            <column name="mandatory">1</column>
            <column name="default_value">2020-01-30</column>
            <column name="template_id">4</column>
            <column name="template_field_type">END_OF_MESSAGES</column>
            <column name="uuid">869ca243-1c16-11ea-8999-0242ac160002</column>
            <column name="creator">1</column>
            <column name="changed_by">NULL</column>
            <column name="date_changed">NULL</column>
            <column name="date_created">1970-01-01 01:00:01.000</column>
            <column name="date_voided">NULL</column>
            <column name="void_reason">NULL</column>
            <column name="voided">0</column>
            <column name="voided_by">NULL</column>
        </insert>
        <insert tableName="messages_template">
            <column name="messages_template_id">5</column>
            <column name="service_query">''</column>
            <column name="service_query_type">''</column>
            <column name="name">Visit reminder</column>
            <column name="uuid">869df249-1c16-11ea-8999-0242ac160002</column>
            <column name="creator">1</column>
            <column name="changed_by">NULL</column>
            <column name="date_changed">NULL</column>
            <column name="date_created">1970-01-01 01:00:01</column>
            <column name="date_voided">NULL</column>
            <column name="void_reason">NULL</column>
            <column name="voided">0</column>
            <column name="voided_by">NULL</column>
        </insert>
        <insert tableName="messages_template_field">
            <column name="messages_template_field_id">40</column>
            <column name="name">Service type</column>
            <column name="mandatory">1</column>
            <column name="default_value">Deactivate service</column>
            <column name="template_id">5</column>
            <column name="template_field_type">SERVICE_TYPE</column>
            <column name="uuid">869f1ba8-1c16-11ea-8999-0242ac160002</column>
            <column name="creator">1</column>
            <column name="changed_by">NULL</column>
            <column name="date_changed">NULL</column>
            <column name="date_created">1970-01-01 01:00:01.000</column>
            <column name="date_voided">NULL</column>
            <column name="void_reason">NULL</column>
            <column name="voided">0</column>
            <column name="voided_by">NULL</column>
        </insert>
        <insert tableName="messages_template_field">
            <column name="messages_template_field_id">41</column>
            <column name="name">Start of messages</column>
            <column name="mandatory">0</column>
            <column name="default_value">2019-12-09</column>
            <column name="template_id">5</column>
            <column name="template_field_type">START_OF_MESSAGES</column>
            <column name="uuid">86a03428-1c16-11ea-8999-0242ac160002</column>
            <column name="creator">1</column>
            <column name="changed_by">NULL</column>
            <column name="date_changed">NULL</column>
            <column name="date_created">1970-01-01 01:00:01.000</column>
            <column name="date_voided">NULL</column>
            <column name="void_reason">NULL</column>
            <column name="voided">0</column>
            <column name="voided_by">NULL</column>
        </insert>
        <insert tableName="messages_template_field">
            <column name="messages_template_field_id">42</column>
            <column name="name">End of messages</column>
            <column name="mandatory">1</column>
            <column name="default_value">2020-01-30</column>
            <column name="template_id">5</column>
            <column name="template_field_type">END_OF_MESSAGES</column>
            <column name="uuid">86a14d9c-1c16-11ea-8999-0242ac160002</column>
            <column name="creator">1</column>
            <column name="changed_by">NULL</column>
            <column name="date_changed">NULL</column>
            <column name="date_created">1970-01-01 01:00:01.000</column>
            <column name="date_voided">NULL</column>
            <column name="void_reason">NULL</column>
            <column name="voided">0</column>
            <column name="voided_by">NULL</column>
        </insert>
        <insert tableName="messages_template">
            <column name="messages_template_id">6</column>
            <column name="service_query">''</column>
            <column name="service_query_type">''</column>
            <column name="name">Survey</column>
            <column name="uuid">86a28ebf-1c16-11ea-8999-0242ac160002</column>
            <column name="creator">1</column>
            <column name="changed_by">NULL</column>
            <column name="date_changed">NULL</column>
            <column name="date_created">1970-01-01 01:00:01</column>
            <column name="date_voided">NULL</column>
            <column name="void_reason">NULL</column>
            <column name="voided">0</column>
            <column name="voided_by">NULL</column>
        </insert>
        <insert tableName="messages_template_field">
            <column name="messages_template_field_id">51</column>
            <column name="name">Service type</column>
            <column name="mandatory">1</column>
            <column name="default_value">Deactivate service</column>
            <column name="template_id">6</column>
            <column name="template_field_type">SERVICE_TYPE</column>
            <column name="uuid">86a3c89f-1c16-11ea-8999-0242ac160002</column>
            <column name="creator">1</column>
            <column name="changed_by">NULL</column>
            <column name="date_changed">NULL</column>
            <column name="date_created">1970-01-01 01:00:01.000</column>
            <column name="date_voided">NULL</column>
            <column name="void_reason">NULL</column>
            <column name="voided">0</column>
            <column name="voided_by">NULL</column>
        </insert>
        <insert tableName="messages_template_field">
            <column name="messages_template_field_id">52</column>
            <column name="name">Preferred day to receive message</column>
            <column name="mandatory">1</column>
            <column name="default_value">Monday,Tuesday,Wednesday,Thursday,Friday,Saturday,Sunday</column>
            <column name="template_id">6</column>
            <column name="template_field_type">DAY_OF_WEEK</column>
            <column name="uuid">86a50f4a-1c16-11ea-8999-0242ac160002</column>
            <column name="creator">1</column>
            <column name="changed_by">NULL</column>
            <column name="date_changed">NULL</column>
            <column name="date_created">1970-01-01 01:00:01.000</column>
            <column name="date_voided">NULL</column>
            <column name="void_reason">NULL</column>
            <column name="voided">0</column>
            <column name="voided_by">NULL</column>
        </insert>
        <insert tableName="messages_template_field">
            <column name="messages_template_field_id">53</column>
            <column name="name">Start of messages</column>
            <column name="mandatory">0</column>
            <column name="default_value">2019-12-09</column>
            <column name="template_id">6</column>
            <column name="template_field_type">START_OF_MESSAGES</column>
            <column name="uuid">86a64bbf-1c16-11ea-8999-0242ac160002</column>
            <column name="creator">1</column>
            <column name="changed_by">NULL</column>
            <column name="date_changed">NULL</column>
            <column name="date_created">1970-01-01 01:00:01.000</column>
            <column name="date_voided">NULL</column>
            <column name="void_reason">NULL</column>
            <column name="voided">0</column>
            <column name="voided_by">NULL</column>
        </insert>
        <insert tableName="messages_template_field">
            <column name="messages_template_field_id">54</column>
            <column name="name">End of daily messages</column>
            <column name="mandatory">1</column>
            <column name="default_value">2020-01-30</column>
            <column name="template_id">6</column>
            <column name="template_field_type">END_OF_MESSAGES</column>
            <column name="uuid">86a79246-1c16-11ea-8999-0242ac160002</column>
            <column name="creator">1</column>
            <column name="changed_by">NULL</column>
            <column name="date_changed">NULL</column>
            <column name="date_created">1970-01-01 01:00:01.000</column>
            <column name="date_voided">NULL</column>
            <column name="void_reason">NULL</column>
            <column name="voided">0</column>
            <column name="voided_by">NULL</column>
        </insert>
    </changeSet>

    <changeSet id="messages-20" author="Arkadiusz Lalo">
        <preConditions>
            <tableExists tableName="messages_template" />
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM messages_template
                WHERE uuid = '868278cc-1c16-11ea-8999-0242ac160002'
            </sqlCheck>
        </preConditions>
        <comment>Update the value of Adherence report daily service query</comment>
        <sql>
            UPDATE messages_template
                SET service_query='select EXECUTION_DATE, MESSAGE_ID, CHANNEL_ID, mssg_status as STATUS_ID from
                (select TIMESTAMP(selected_date, times) AS EXECUTION_DATE, 1 AS MESSAGE_ID, :Service_type AS CHANNEL_ID
                from (select * from (select adddate(''2019-12-01'',t4*10000 + t3*1000 + t2*100 + t1*10 + t0) selected_date
                from  (select 0 t0 union select 1 union select 2 union select 3 union select 4 union  select 5 union
                select 6 union select 7 union select 8 union select 9) t0,  (select 0 t1 union select 1 union
                select 2 union select 3 union select 4 union  select 5 union select 6 union select 7 union
                select 8 union select 9) t1,  (select 0 t2 union select 1 union select 2 union select 3 union
                select 4 union  select 5 union select 6 union select 7 union select 8 union select 9) t2,
                (select 0 t3 union select 1 union select 2 union select 3 union select 4 union  select 5 union
                select 6 union select 7 union select 8 union select 9) t3,  (select 0 t4 union select 1 union
                select 2 union select 3 union select 4 union  select 5 union select 6 union select 7 union
                select 8 union select 9) t4) v where selected_date between :Start_of_daily_messages and :End_of_daily_messages
                and selected_date between :startDate and :endDate  and :Week_day_of_delivering_message
                like concat(''%'',DAYNAME(selected_date),''%'') ) dates JOIN (select :bestContactTime times) timeslist) temp
                LEFT JOIN (select mssg.msg_send_time as mssg_dates, mssg.status as mssg_status
                from messages_scheduled_service_group mssg where mssg.patient_id = :patientId) mss on mss.mssg_dates = EXECUTION_DATE;'
            WHERE uuid = '868278cc-1c16-11ea-8999-0242ac160002';
        </sql>
    </changeSet>
</databaseChangeLog>
